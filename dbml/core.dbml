Table teams {
  number smallint [not null]
  name text [not null]
  created_at timestamptz [not null, default: `now()`]

  indexes {
    number [pk] // patch: include name
  }

  Note: 'A team utilizing the platform'
}

Table users {
  id uuid [not null, default: `auth.uid()`]
  name text [not null]
  created_at timestamptz [not null, default: `now()`]

  indexes {
    id [pk] // patch: include name
  }

  Note: 'A user of the platform'
}

Table team_users {
  user_id uuid [not null]
  team_num smallint [not null]
  added_by uuid [default: `auth.uid()`]
  joined_at timestamptz [not null, default: `now()`]

  indexes {
    user_id [pk] // patch: include team_num
    (team_num, user_id) [unique]
  }

  Note: 'A user\'s association with a team'
}
Ref: team_users.user_id > users.id [delete: cascade]
Ref: team_users.team_num > teams.number [delete: cascade]
Ref: team_users.added_by > users.id [delete: set null]

Table team_requests {
  user_id uuid [not null, default: `auth.uid()`]
  team_num smallint [not null]
  requested_at timestamptz [not null, default: `now()`]

  indexes {
    user_id [pk]
    (team_num, requested_at) // patch: include user_id
  }

  Note: 'A user\'s request to join a team'
}
Ref: team_requests.user_id > users.id [delete: cascade]
Ref: team_requests.team_num > teams.number [delete: cascade]

Table disabled_users {
  user_id uuid [not null]
  disabled_by uuid [not null, default: `auth.uid()`]
  disabled_at timestamptz [not null, default: `now()`]

  indexes {
    user_id [pk]
    (disabled_by, disabled_at)
  }

  Note: 'A user whose privileges have been temporarily revoked'
}
Ref: disabled_users.user_id > users.id [delete: cascade]
Ref: disabled_users.disabled_by > users.id [delete: cascade]

Table permission_types {
  id citext [not null]
  name text [not null]
  description text [not null]

  indexes {
    id [pk]
  }

  Note: 'Types of permissions users may hold'
}

// RLS rules:
// - Allow users to SELECT their own permissions
// - Allow users with 'manage_team' role to INSERT or DELETE their team's permissions
Table permissions {
  user_id uuid [not null]
  permission_type citext [not null]
  granted_by uuid [default: `auth.uid()`]
  granted_at timestamptz [default: `now()`]

  indexes {
    (user_id, permission_type) [pk]
    (granted_by, granted_at)
  }

  Note: 'A user\'s permission'
}
Ref: permissions.user_id > users.id [delete: cascade]
Ref: permissions.permission_type > permission_types.id [delete: cascade]
Ref: permissions.granted_by > users.id [delete: set null]
