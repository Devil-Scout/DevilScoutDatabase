--- 50_generated.sql	2024-09-13 15:51:10.841173588 -0400
+++ 52_generated.sql	2024-09-13 16:03:35.746489311 -0400
@@ -17,6 +17,11 @@
   'playoff'
 );

+CREATE OR REPLACE FUNCTION
+frc_match_level_2_text(frc_match_level) RETURNS TEXT
+AS $$ SELECT $1 $$
+STRICT IMMUTABLE LANGUAGE SQL;
+
 CREATE TYPE "frc_alliance" AS ENUM (
   'red',
   'blue'
@@ -77,7 +77,10 @@
 );

 CREATE TABLE "frc_events" (
-  "key" citext PRIMARY KEY,
+  "key" citext PRIMARY KEY
+    GENERATED ALWAYS AS
+      (season || code)
+      STORED,
   "season" smallint NOT NULL,
   "code" citext NOT NULL,
   "type" frc_event_type,
@@ -98,7 +101,10 @@
 );

 CREATE TABLE "frc_teams" (
-  "key" citext PRIMARY KEY,
+  "key" citext PRIMARY KEY
+    GENERATED ALWAYS AS
+      (season || '_' || number)
+      STORED,
   "season" smallint NOT NULL,
   "number" smallint NOT NULL,
   "name" text NOT NULL,
@@ -123,7 +129,10 @@
 );

 CREATE TABLE "frc_matches" (
-  "key" citext PRIMARY KEY,
+  "key" citext PRIMARY KEY
+    GENERATED ALWAYS AS
+      (event_key || '_' || frc_match_level_2_text(level) || 's' || set || 'm' || number)
+      STORED,
   "event_key" citext NOT NULL,
   "level" citext NOT NULL,
   "set" smallint NOT NULL,
